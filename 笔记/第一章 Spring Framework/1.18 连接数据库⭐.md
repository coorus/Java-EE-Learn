# 连接数据库
![gqj](../Source/attachments/gqj.jpg)
## 一. 使用JDBC连接数据库

### 1.1 添加JDBC依赖

在`pom.xml`文件中添加以下依赖：

```xml
<!-- Spring 对 JDBC 的支持 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
</dependency>

<!-- MySQL 驱动，如果使用其他数据库，需引入相应的驱动 -->
<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
    <scope>runtime</scope>
</dependency>
```

### 1.2 在 `application.properties` 配置文件中设置数据库连接信息

```properties
// application.properties
# 数据库连接 URL
spring.datasource.url=jdbc:mysql://localhost:3306/spring  
  
# 数据库用户名  
spring.datasource.username=root  
  
# 数据库密码  
spring.datasource.password=0912  
  
# 数据库驱动类名  
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

### 1.3 通过 `DataSource` 获取数据库连接

在 Java 代码中使用 `DataSource` 获取数据库连接：

```java
public static void main(String[] args) throws SQLException {
    ConfigurableApplicationContext ioc = SpringApplication.run(DatabaseApplication.class, args);
    DataSource dataSource = ioc.getBean(DataSource.class);
    Connection connection = dataSource.getConnection();
}
```

## 二、`DataSource` 

1. `DataSource` 是一个接口，提供了一种标准方式获取数据库连接，可以灵活替换实现。
2. `DataSource` 对象是**通过配置信息创建**的，由 Spring Boot 自动创建和管理。
3. 源码验证：DataSourceProperties读取配置，DataSourceConfiguration::Hikari创建DataSource
4. Spring 默认使用 `HikariDataSource` 实现，这是一个高效的连接池实现。

---

### 1. 连接池

连接池是一种**通过重复利用连接**来**减少连接创建和关闭的开销**的技术，可以**显著提高效率**。

![|450](attachments/Pasted%20image%2020240919151808.png)
### 2. 验证 `HikariDataSource` 连接池

```java
public static void main(String[] args) throws SQLException {
    ConfigurableApplicationContext ioc = SpringApplication.run(DatabaseApplication.class, args);
    DataSource dataSource = ioc.getBean(DataSource.class);
    for (int i = 0; i < 5; ++i) {
        Connection connection = dataSource.getConnection();
        System.out.println(connection);
        connection.close();
    }
}
```

在此代码中，虽然获取了 5 个连接，但实际上自始至终复用了同一个连接。

---

### 3. 替换 `DataSource` 实现

可以通过配置自定义的 `DataSource` 来替换默认的 `HikariDataSource`，例如使用原始的 JDBC 实现：

```java
@Configuration
public class Config {

    @Bean
    public DataSource dataSource(DataSourceProperties properties) {
        // 使用 DriverManagerDataSource，每次重新获取一个连接
        DriverManagerDataSource dataSource = new DriverManagerDataSource();
        dataSource.setDriverClassName(properties.getDriverClassName());
        dataSource.setUrl(properties.getUrl());
        dataSource.setUsername(properties.getUsername());
        dataSource.setPassword(properties.getPassword());
        return dataSource;
    }
}
```

